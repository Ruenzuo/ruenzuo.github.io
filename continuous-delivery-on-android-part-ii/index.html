<!DOCTYPE html>
<html>
<head>
    
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Continuous Delivery on Android - Part II</title>
    <meta name="description" content="">
    
	<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:100,200,300,400,500,700">
    
	<link rel="stylesheet" href="/assets/css/style.css">
	<link rel="stylesheet" href="/assets/css/post.css">
	<meta name="generator" content="Ghost 0.3" />
<link rel="alternate" type="application/rss+xml" title="RSS" href="/rss/">
</head>
<body class="post-template tag-android">
    <aside class="menu menu-vertical menu-left" id="menu_kathreen">
    <h3>Social News</h3>
    <img src="/assets/images/Twitter_logo_white.png" alt="latest from twitter">
    <div data-tweetable="tweets"></div>
</aside>
    <div class="basecontainer_kathreen">
        <header id="header_kathreen">
    <nav id="nav_kathreen">
        <a id="showLeftPush">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
        </a>
    </nav>
    <h1 id="logo_kathreen">
        <a href="http://ruenzuo.github.io" id="brand_kathreen">
        
        Ruenzuo.io
        </a>
    </h1>
</header>
        <div class="wrapper_kathreen">
            
	
<main class="main_kathreen" role="main">
	<div id="page_kathreen">
		
		<section id="post_kathreen" role="article" itemscope itemtype="http://schema.org/Article">
            <time datetime="2013-11-26" itemprop="datePublished">Tuesday 26 Nov 2013</time>
            <div class="share_kathreen">
    <span>Share this Post:  </span>
    <span class="twitter_kathreen"><a href="http://twitter.com/share?text=Continuous Delivery on Android - Part II&url=http://ruenzuo.github.io/continuous-delivery-on-android-part-ii/" target="_blank"></a></span>
    <span class="facebook_kathreen"><a href="http://www.facebook.com/sharer.php?u=http://ruenzuo.github.io/continuous-delivery-on-android-part-ii/" target="_blank"></a></span>
    <span class="googleplus_kathreen"><a href="https://plus.google.com/share?url=http://ruenzuo.github.io/continuous-delivery-on-android-part-ii/" target="_blank"></a></span>
</div>
			<h1>Continuous Delivery on Android - Part II</h1>
			<p>This is the second part of my post about continuous delivery setup on Android using <a href="http://www.gradle.org/">gradle</a>, <a href="https://travis-ci.org/">Travis</a> and <a href="https://www.testflightapp.com/">TestFlight</a>. For this part, I'll be referencing this <a href="https://github.com/Ruenzuo/android-cd-travis-example">repository</a>. If you're interested in what is continuous delivery or what are the motivations and goals of it be sure to check the <a href="http://ruenzuo.github.io/continuous-delivery-on-android-part-i/">first part</a> of this post.</p>

<p>When we finish you'll be dancing like our little friend.</p>

<p class="image-center"><img src="https://dl.dropboxusercontent.com/u/99114459/dancing-android.gif"></p>

<hr />

<h3 id="gradle">Gradle</h3>

<p>Gradle has been chosen by Google's ADT team to be Android's <a href="http://tools.android.com/tech-docs/new-build-system/user-guide">next build system</a> so Ant support will be dropped sometime in the future. The following assumes that you have basic knowledge about Android's gradle plugin and Groovy domain-specific language.</p>

<p>I'll make a brief explanation of my <code>build.gradle</code> file shown below in 3 sections:</p>

<ul>
<li>Build configurations</li>
<li>Product flavors</li>
<li>Dependencies</li>
</ul>

<script src="https://gist.github.com/Ruenzuo/7668340.js"></script>

<h5 id="buildconfigurations">Build Configurations</h5>

<p>For this example, I'm using <code>targetSdkVersion 18</code> and <code>buildToolsVersion "18.0.1"</code>.</p>

<p>I'm setting <code>debuggable true</code> and <code>zipAlign true</code> on the default debug build type because this will be the APK I'll be delivering with TestFlight. </p>

<h5 id="productflavors">Product flavors</h5>

<p>I'm adding two product flavors <code>free</code> and <code>paid</code>. You need to configure your project <code>src</code> directory to something like <a href="https://github.com/Ruenzuo/android-cd-travis-example/tree/master/WeatherApp/src">this</a> so gradle can grab the correct files for compiling each version. You're free to add different resources for each version, for instance, you can add <strong>different application icons</strong> (<a href="https://github.com/Ruenzuo/android-cd-travis-example/blob/master/WeatherApp/src/free/res/drawable-hdpi/ic_launcher.png">free</a> and <a href="https://github.com/Ruenzuo/android-cd-travis-example/blob/master/WeatherApp/src/paid/res/drawable-hdpi/ic_launcher.png">paid</a> icons) on each <code>res</code> directory.</p>

<p>For each product flavor, I'm configuring a different <code>packageName</code>, in order to be able to <strong>install both versions on the same device</strong>, and adding a <code>buildConfig</code> variable which can be used from anywhere on the project, for example: <strong>to enable or disable features</strong> on the <a href="https://github.com/Ruenzuo/android-cd-travis-example/blob/master/WeatherApp/src/main/java/com/ruenzuo/weatherapp/base/CitiesBaseActivity.java#L49">base code</a> or <strong>to test specific features for each build</strong> on your <a href="https://github.com/Ruenzuo/android-cd-travis-example/blob/master/WeatherApp/src/instrumentTest/java/com.ruenzuo.weatherapp.test/CitiesActivityFunctionalTests.java#L28">tests</a>.</p>

<h5 id="dependencies">Dependencies</h5>

<p>With gradle, you can also specify specific product flavor dependencies, to make APK lighter, and exclude transitive dependencies, so compiler doesn't complain about duplicated files on compilation. In this example, we don't need to compile <code>libs/GoogleAdMobAdsSdk-6.4.1.jar</code> on paid version because its not referenced. </p>

<h3 id="travis">Travis</h3>

<p>Travis is a is a hosted continuous integration service for the open source community. It's fully integrated with GitHub. The following assumes that you have basic knowledge about Travis, unix shell and Android command line tools.</p>

<p>I'll explain the most important parts of my <code>.travis.yml</code> file shown below in 5 sections:</p>

<ul>
<li>Branches</li>
<li>Before install</li>
<li>Install</li>
<li>Before script</li>
<li>Script</li>
</ul>

<script src="https://gist.github.com/Ruenzuo/7668407.js"></script>

<h5 id="branches">Branches</h5>

<p>In this part, I'm telling Travis to <strong>build only master branch</strong>. Any commit on the master branch will trigger a build, but this can be avoided by adding <code>[ci skip]</code> to the <a href="https://github.com/Ruenzuo/android-cd-travis-example/commit/5a5f37b18bd822075f33d00087ceb217cf0e0798">commit message</a>.</p>

<h5 id="beforeinstall">Before install</h5>

<p>Sadly, Travis doesn't offer an Android development environment so we need to install everything by our own. This is done on <code>before_install</code> part of the script.</p>

<h5 id="install">Install</h5>

<p>I'm skipping the default <code>install</code> behaivour of Travis described <a href="http://about.travis-ci.org/docs/user/languages/java/#Projects-Using-Gradle">here</a>, because I really don't need it, I'm using gradle wrapper which I think it's the best.</p>

<h5 id="beforescript">Before script</h5>

<p>On <code>before_script</code> I'm using <a href="https://github.com/Ruenzuo/android-cd-travis-example/blob/master/Scripts/wait_for_emulator.sh">this</a> script to launch the simulator and wait until it's ready, then I'm using <code>adb shell input keyevent 82 &amp;</code> which gives the virtual device an unlock message.</p>

<h5 id="script">Script</h5>

<p>Finally, on <code>script</code> I'm using the gradle wrappler to run instrument tests, this task will also generate debug APK both for free and paid flavors on the following path <code>$TRAVIS_BUILD_DIR/WeatherApp/build/apk/</code>. The rest of the script will be described on the next topic. </p>

<h3 id="testflight">TestFlight</h3>

<p>TestFlight is a free platform used to distribute beta and internal iOS/Android applications to team members over-the-air. The following assumes that you have basic knowledge about the service.</p>

<p>As we seen on the last section <code>script</code> of the <code>.travis.yml</code> file, I'm using <code>curl</code> to upload both APKs to TestFlight API adding <code>distribution_lists</code> parameter so <strong>each version is distributed to a different set of recipients</strong>.</p>

<p>For this, you need to create and configure two applications on TestFlight:</p>

<p class="image-center"><img src="https://dl.dropboxusercontent.com/u/99114459/testflight.png"></p>

<p>Get the <code>api_token</code> and <code>team_token</code> from TestFlight and create the desired number of <code>distribution_lists</code>. You can find this option on the bottom of the People section of the webpage:</p>

<p class="image-center"><img src="https://dl.dropboxusercontent.com/u/99114459/distribution-lists.png"></p>

<p>Remember that you can specify if you want to <code>notify</code> those users about a new build. Another cool thing you can do is to add <code>notes</code> for the build information, here you can use Travis <a href="http://about.travis-ci.org/docs/user/ci-environment/#Environment-variables">environment variables</a> to add interesting information to those notes.</p>

<hr />

<h3 id="closing">Closing</h3>

<p>Hopefully you get everything right. But if not, just send me an an email to <a href='mailto:renzo.crisostomo@me.com'>renzo.crisostomo@me.com</a>. Good luck and thanks for reading.</p>
            <hr>
            
                <div class="tags_kathreen">Tags: Android</div>
                <hr>
            
            
                <footer class="postfooter_kathreen">
    <address itemscope itemtype="http://schema.org/Person">
        
            <div class="authorimage_kathreen"><img class="avatar_kathreen" src="/content/images/2013/Nov/f14f9b3ae08c7ddfbd59258923829f40.png" itemprop="image"></div>
        
        
            <h4 class="authorname_kathreen"><span itemprop="author">Renzo Crisóstomo</span></h4>
        
        
            <div class="authorwebsite_kathreen"><a href="https://github.com/Ruenzuo" itemprop="url">https://github.com/Ruenzuo</a></div>
        
    </address>
    <div class="authorbio_kathreen">
        <hr>
        
            <p>Software engineer working on mobile application development on iOS and Android using agile methodologies. What could possibly go wrong? Follow me to discover it.</p>
        
    </div>
</footer>
            
			<div class="comments_kathreen">
                <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'ruenzuoio'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
			</div>
		</section>
		
        <footer id="foot_kathreen">
    <p class="left text-left"><span class="ghost_icon_kathreen">Proudly published with <img src="/assets/images/ghost-logo.png" alt="Ghost Logo"><a class="icon-ghost" href="http://tryghost.org" target="_blank">&nbsp;&nbsp;Ghost</a></span></p>
    <p class="left text-center"><span>Developed by <a href="http://themeforest.net/user/juno-themes">juno-themes</a></span></p>
    <p class="left text-center"><span>Copyright &copy; 2013 &bull; <a href="http://ruenzuo.github.io">Ruenzuo.io</a></span></p>
    <p class="left text-right"><span class="rss_kathreen"><a target="_blank" href="/rss/"><img src="/assets/images/rss.png" alt="Subscribe!">&nbsp;&nbsp;RSS Subscribe</a></span></p>
</footer>
	</div>
</main>
        </div>
    </div>
    <script src="/shared/vendor/jquery/jquery.js"></script>
	<script src="/assets/js/jquery-1.9.1.min.js"></script>
	<script src="/assets/js/jquery.tweetable.js"></script>
	<script src="/assets/js/masonry.js"></script>
	<script src="/assets/js/classie.js"></script>
	<script src="/assets/js/main.js"></script>
	<script src="/assets/js/detect.js"></script>
	<script src="/assets/js/smoothscroll.js"></script>
    <script>
        $(document).ready(function(){
            $('[data-tweetable]').tweetable({
            via: 'Ruenzuo'
            });
        });
    </script>
</body>
</html>